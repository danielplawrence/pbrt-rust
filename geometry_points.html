<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Points - pbrt-rust</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Implementation notes for a physically-based renderer in Rust">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="geometry_and_transformations.html"><strong aria-hidden="true">1.</strong> Geometry and Transformations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="geometry_vectors.html"><strong aria-hidden="true">1.1.</strong> Vectors</a></li><li class="chapter-item expanded "><a href="geometry_points.html" class="active"><strong aria-hidden="true">1.2.</strong> Points</a></li><li class="chapter-item expanded "><a href="geometry_normals.html"><strong aria-hidden="true">1.3.</strong> Normals</a></li><li class="chapter-item expanded "><a href="geometry_rays.html"><strong aria-hidden="true">1.4.</strong> Rays</a></li><li class="chapter-item expanded "><a href="geometry_bounding_boxes.html"><strong aria-hidden="true">1.5.</strong> Bounding Boxes</a></li><li class="chapter-item expanded "><a href="geometry_transformations.html"><strong aria-hidden="true">1.6.</strong> Transformations</a></li><li class="chapter-item expanded "><a href="geometry_animating_transformations.html"><strong aria-hidden="true">1.7.</strong> Animating Transformations</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">pbrt-rust</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="geometry-and-transformations"><a class="header" href="#geometry-and-transformations">Geometry and Transformations</a></h1>
<h2 id="12-points"><a class="header" href="#12-points">1.2 Points</a></h2>
<p>A point is a location in 2d or 3d space. 
We can represent points in terms of their co-ordinates -- so \(x,y\) for 2d and \(x,y,z\) for 3d points.
Although this is the same basic representation as vectors, the fact that they represent positions instead of directions means that they will be treated differently. The Rust structs for points look similar to vectors:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct Point2D&lt;T&gt; {
    pub x: T,
    pub y: T,
}
impl&lt;T: Scalar&gt; Point2D&lt;T&gt; {
    pub fn new(x: T, y: T) -&gt; Self {
        Point2D{x, y}
    }
}
pub struct Point3D&lt;T&gt; {
    pub x: T,
    pub y: T,
    pub z: T,
}
impl&lt;T: Scalar&gt; Point3D&lt;T&gt; {
    pub fn new(x: T, y: T, z: T) -&gt; Self {
        Point3D{x, y, z}
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>The C++ pbrt implementation also includes methods for:</p>
<ul>
<li>Converting a 3d point to 2d by dropping the 'z' component.</li>
<li>Converting points of one type (e.g. floats) to another (e.g. int)</li>
<li>Converting a point of one type to a vector of another type.</li>
</ul>
<p>To achieve this in Rust, we can add appropriate methods to the <code>Point</code> implementations.
To do the type conversions, we need to add additional type parameters. Taking the conversion of <code>Point3d</code> betweent types as an example:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;T: Scalar&gt; Point3d&lt;T&gt; {
    ...
    pub fn from&lt;U, V: From&lt;U&gt;&gt;(p: Point3d&lt;U&gt;) -&gt; Point3d&lt;V&gt; {
        Point3d{x: p.x.into(), y: p.y.into(), z: p.z.into()}
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>The <code>from&lt;U, V&gt;</code> statement declares two generic types, then <code>(p: Point3d&lt;U&gt;) -&gt; Point3d&lt;V&gt;</code> specifies that we will take an argument of one type and convert to the other. The trait bound on <code>V</code>, <code>V: From&lt;U&gt;</code> means that we will only support types which support this conversion. Types that satisfy this trait will have an <code>into()</code> method which will do the cast for us.</p>
<h2 id="operations-on-vectors-and-points"><a class="header" href="#operations-on-vectors-and-points">Operations on vectors and points</a></h2>
<p>We can add or subtract vectors and points by applying the addition/subtraction operation componentwise. Adding and subtracting vectors and points has the affect of offsetting the point along the vector. So if we think of a vector as a path, if we start at point A and add the vector, we end up at point B. Subtraction has the opposite affect -- if we start at point A and subtract the vector, we walk in the opposite direction of its trajectory.</p>
<p align="center">
    <img src="images/vector_point_addition.png" style="background-color: white" width="200">
    <img src="images/vector_point_subtraction.png" style="background-color: white" width="200">
</p>
<p><em>Fig 1: Geometrical interpretation of vector-point addition (left) and vector-point subtraction (right).</em></p>
<p>To implement these in Rust, we can follow the same pattern as for vectors -- importing the <code>std::ops::Add</code> and <code>std::ops::Sub</code> traits and providing implementations.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;T: Scalar&gt; Add&lt;Vector3d&lt;T&gt;&gt; for Point3d&lt;T&gt; {
    type Output = Self;
    fn add(self, other: Vector3d&lt;T&gt;) -&gt; Self {
        Point3d{x: self.x + other.x, y: self.y + other.y, z: self.z + other.z}
    }
}
impl&lt;T: Scalar&gt; Sub&lt;Vector3d&lt;T&gt;&gt; for Point3d&lt;T&gt; {
    type Output = Self;
    fn sub(self, other: Vector3d&lt;T&gt;) -&gt; Self {
        Point3d{x: self.x - other.x, y: self.y - other.y, z: self.z - other.z}
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>Subtracting two points gives us the vector between them, as shown below:</p>
<p align="center">
    <img src="images/point_point_subtraction.png" style="background-color: white" width="200">
</p>
<p>This means that we can easily find the distance between two points by subtracting them and taking the length of the resulting vector. We can implement this by using the <code>length()</code> method added to the <code>Vector</code> structs in the previous chapter. First we implement <code>Sub</code> for points, which returns a vector:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;T: Scalar&gt; Sub&lt;Point3d&lt;T&gt;&gt; for Point3d&lt;T&gt; {
    type Output = Vector3d&lt;T&gt;;
    fn sub(self, other: Self) -&gt; Self::Output {
        Vector3d{x: self.x - other.x, y: self.y - other.y, z: self.z - other.z}
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>Then we add the <code>distance</code> method to the <code>impl</code> block for the <code>Point</code> structs. I've also added <code>distance_squared</code> following the c++ pbrt implementation:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;T: Scalar&gt; Point3d&lt;T&gt; {
    ...
    pub fn distance(self, other: Self) -&gt; T {
        return (self - other).length();
    }
    pub fn distance_squared(self, other: Self) -&gt; T {
        return (self - other).squared_length();
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>Following the pbrt book, we also include methods for adding points and scalar multiplication with a point, which are similar to the implementation for <code>Vector</code>.</p>
<h2 id="linear-interpolation"><a class="header" href="#linear-interpolation">Linear interpolation</a></h2>
<p>It's often necessary to interpolate between two points. For example, given the two points \((x_0, y_0)\) and \((x_1, y_1)\) in the image below, we may want to find some intermediate point \((x, y)\).</p>
<p align="center">
    <img src="images/linear_interpolation.png" style="background-color: white" width="200">
</p>
<p><em>Fig 2: Linear interpolation</em></p>
<p>The goal of interpolation is to be able to return arbitrary points which lie between two values. So we are aiming for a method with the following signature:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;T: Scalar&gt; Point2d&lt;T&gt; {
    ...
    pub fn lerp(&amp;self, t: T, p0: Point2d&lt;T&gt;, p1: Point2d&lt;T&gt;) -&gt; Point2d&lt;T&gt;;
}
<span class="boring">}
</span></code></pre></pre>
<p>We want this method to return a point at p0 when the <em>t</em> argument is 0, and a point at p1 when the value of t is 1.
We can interpolate between two points by imagining a straight line between them, as in the above diagram, then picking points along it. We can get a line like this by finding the vector between the two points (using subtraction, as implemented earlier), then multiplying the resulting vector by some amount. For example, if we scale it by 0.5, we get a vector pointing in the same direction, but with half the length. We then just need to add the starting point (if we just took the x and y values of the vector, our line would start from the origin).</p>
<p align="center">
    <img src="images/lerp_1.png" style="background-color: white" width="150">
        <img src="images/lerp_2.png" style="background-color: white" width="150">
            <img src="images/lerp_3.png" style="background-color: white" width="150">
                <img src="images/lerp_4.png" style="background-color: white" width="150">
</p>
<p><em>Fig 3: Linear interpolation by finding the vector between two points then scaling it.</em></p>
<p>The above process can be translated into code as follows:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;T: Scalar&gt; Point2d&lt;T&gt; {
    ...
        pub fn lerp(self, other: Self, t: T) -&gt; Self {
        return self + (other - self) * t;
    }
}
<span class="boring">}
</span></code></pre></pre>
<h2 id="miscellaneous-point-operations"><a class="header" href="#miscellaneous-point-operations">Miscellaneous point operations</a></h2>
<p>The c++ implementation of pbrt includes:</p>
<ul>
<li>operations for returning component-wise min and max</li>
<li>operations for applying floor(), ceil(), and abs() to each component and returning a new point</li>
<li>a permute operation which returns a new point with components permuted based on some indices</li>
</ul>
<p>These are mostly straightfoward, although it should be noted that floor() and ceil() are only defined for floating-point types, so we need to define these in a separate <code>impl</code> block which specifies the <code>Float</code> trait bound:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;T: Scalar + Float&gt; Point3d&lt;T&gt; {
    pub fn floor(self) -&gt; Self {
        Point3d::new(self.x.floor(), self.y.floor(), self.z.floor())
    }
    pub fn ceil(self) -&gt; Self {
        Point3d::new(self.x.ceil(), self.y.ceil(), self.z.ceil())
    }
}
<span class="boring">}
</span></code></pre></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="geometry_vectors.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="geometry_normals.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="geometry_vectors.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="geometry_normals.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
