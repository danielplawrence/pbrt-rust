<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Vectors - pbrt-rust</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Implementation notes for a physically-based renderer in Rust">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="geometry_and_transformations.html"><strong aria-hidden="true">1.</strong> Geometry and Transformations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="geometry_vectors.html" class="active"><strong aria-hidden="true">1.1.</strong> Vectors</a></li><li class="chapter-item expanded "><a href="geometry_points.html"><strong aria-hidden="true">1.2.</strong> Points</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">pbrt-rust</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="vectors"><a class="header" href="#vectors">Vectors</a></h1>
<p>1.1 Vectors</p>
<p>A vector is a quantity with a magnitude and a direction. We can imagine a vector as a pointed arrow, where the direction of the arrow signals the direction of the vector, and the length of the arrow represents magnitude.</p>
<p align="center">
    <img src="images/3dvector.png" style="background-color: white" width="200">
</p>
<p><em>Fig 1: A visual representation of a three-dimensional vector.</em></p>
<p>Vectors will give our renderer the mathematical foundation for modeling rays of light. Our renderer will represent vectors in terms of their co-ordinates from the origin. For example, the two-dimensional vector \(V=(1,1)\)
can be visualized as a line starting at the origin (0,0) and extending to the point (4,2)</p>
<p align="center">
    <img src="images/2d_vector.png" style="background-color: white" width="200">
</p>
<p>To represent vectors in our rust renderer, we will use two structs: <code>Vector2d</code> for the two-dimensional case, and <code>Vector3d</code> for the three-dimensional case. Because we may want to create vectors of both floating-point and integer types in our rendering application, it's useful to implement these as generic types, as follows:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub struct Vector2d&lt;T&gt; {
    pub x: T,
    pub y: T
}
impl&lt;T&gt; Vector2d&lt;T&gt; {
    fn new(x: T, y: T) -&gt; Self {
        Vector2d { x, y }
    }
}

pub struct Vector3d&lt;T&gt; {
   pub x: T,
   pub y: T,
   pub z: T
}
impl&lt;T&gt; Vector3d&lt;T&gt; {
    fn new(x: T, y: T, z: T) -&gt; Self {
        Vector3d { x, y, z }
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>For the remainder of these examples, I'll focus on the implementations for the <code>Vector3d</code> class, which are essentially the same as for <code>Vector2d</code>.</p>
<p>The components of vectors can be accessed as simple properties on the struct (<code>vec.x</code>, <code>vec.y</code> etc.). For some algorithms, it is also useful to be able to iterate over the components of vectors, so in addition to allowing access by property, we overload the index operator to allow <code>vec[0]</code>, <code>vec[1]</code> etc. To overload operators in Rust, we import the relevant trait from std::ops and provide an impl statement, as below:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::ops::Index;

impl&lt;T&gt; Index&lt;usize&gt; for Vector3d&lt;T&gt; {
    type Output = T;
    fn index(&amp;self, index: usize) -&gt; &amp;Self::Output {
        match index {
            0 =&gt; &amp;self.x,
            1 =&gt; &amp;self.y,
            2 =&gt; &amp;self.z,
            _ =&gt; panic!(&quot;Index out of bounds&quot;)
        }
    }
}
<span class="boring">}
</span></code></pre></pre>
<h3 id="adding-and-subtracting-vectors"><a class="header" href="#adding-and-subtracting-vectors">Adding and subtracting vectors</a></h3>
<p>To add two vectors we just add up the components item-by-by item. So if we have two three-dimensional vectors \(V\) and \(W\), their sum is a new vector where each component is the sum of the corresponding components of V and W:</p>
<p>\[
V=(1,3,5) \\
W=(2,4,6)  \\
V+W=(Vx+Wx,Vy+Wy,Vz+Wz) \\
=(1+2,3+4,5+6) \\
=(3,7,11) \\
\]</p>
<p>The geometric interpretation of vector addition is equivalent to imagining the two vectors arranged to form a path, where the first vector starts at the origin, and the second vector starts where the first terminates. If we follow the second vector to its terminus, we find outselves at the co-ordinates representing the components of the new vector. The diagram below shows this for two vectors \(V=(4,2)\) and \(W=(−1,3)\), giving the expected result of \(V+W=(3,5)\)</p>
<p align="center">
    <img src="images/vector_addition.png" style="background-color: white" width="200">
</p>
<p><em>Fig 2: Geometric interpretation of vector addition.</em></p>
<p>As one might expect, subtraction is also applied elementwise:</p>
<p>\[
V=(1,3,5) \\
W=(2,4,6) \\
V−W=(V_x−W_x,V_y−W_y,V_z−W_z) \\
=(1−2,3−4,5−6) \\
=(−1,−2,−1) \\
\]
The geometric interpretation of vector subtraction is equivalent to imagining both vectors as paths originating at the origin, and finding the vector which connects the second operand to the first operand. The diagram below shows this for two vectors \(V=(5,2)\)
and \(W=(3,5)\). Subtracting V from W gives us \(W−V=(−2,3)\).</p>
<p align="center">
    <img src="images/vector_subtraction.png" style="background-color: white" width="200">
</p>
<p><em>Fig 3: Geometric interpretation of vector subtraction.</em></p>
<p>To implement these operations in Rust, we import the <code>std::ops::Add</code> and <code>std::ops::Sub</code> traits and provide implementations with <code>impl</code> statements. Things get a little tricky here, because the implementations will need to use the + and - operator on the vector components; however, because we are using generics, we are unable to guarantee that the components (which could be of any type) actually support these operators. To get around this, we can use the <code>num::Num</code> trait as a trait bound on our implementations, meaning that the <code>Vector</code> structs can only be created with numeric types:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use num::Num;

impl&lt;T:Num&gt; Vector3d&lt;T&gt; {
    fn new(x: T, y: T, z: T) -&gt; Self {
        Vector3d { x, y, z }
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>The <code>impl&lt;T:Num&gt;</code> statement means that we are implementing the new constructor only for types which support numeric operations. With this in place, we can import the <code>Add</code> and <code>Sub</code> traits from the <code>std::ops</code> crate, and define our addition and subtraction operations:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::ops::{Index, Add, Sub};

impl &lt;T:Num&gt; Add for Vector3d&lt;T&gt; {
    type Output = Vector3d&lt;T&gt;;
    fn add(self, other: Self) -&gt; Self::Output {
        Vector3d::new(self.x + other.x, self.y + other.y, self.z + other.z)
    }
}
impl &lt;T:Num&gt; Sub for Vector3d&lt;T&gt; {
    type Output = Vector3d&lt;T&gt;;
    fn sub(self, other: Self) -&gt; Self::Output {
        Vector3d::new(self.x - other.x, self.y - other.y, self.z - other.z)
    }
}
<span class="boring">}
</span></code></pre></pre>
<h3 id="scalar-multiplication-and-division"><a class="header" href="#scalar-multiplication-and-division">Scalar multiplication and division</a></h3>
<p>A vector can be multiplied and divided by a scalar value. To implement this, we just apply the multiplication/division operation element-wise to the vector.</p>
<p>So scalar multiplication will look like this:</p>
<p>\[
V=(1,3,5) \\
n=10 \\
Vn=(V_x+n,V_y+n,V_z+n) \\
=(1x10,3x10,5x10) \\
=(10,30,50) \\
\]
...and scalar division will look like this:</p>
<p>\[
V=(1,3,5) \\
n=2 \\
Vn=(V_xn,V_yn,V_zn) \\
=(12,32,52) \\
=(0.5,1.5,2.5) \\
\]</p>
<p>The geometric interpretation of these operations that they scale the vector's magnitude by the scalar degree. So the vector \(V=(2,2)\)
(of length two) multipled by 2 will become \((4,4)\), which is of length 4; dividing this by 2 returns the original value of \(V\)</p>
<p align="center">
    <img src="images/vector_scalar_mul.png" style="background-color: white" width="200">
</p>
<p><em>Fig 4: Geometric interpretation of multiplying a vector by a scalar.</em></p>
<p>In Rust code, this is pretty much the same as what we did for the <code>Add</code> and <code>Sub</code> operations -- we again import the relevant traits from the <code>std::ops</code> library, and provide implementations.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::ops::{Index, Add, Sub, Mul, Div};

impl &lt;T:Num&gt; Mul for Vector3d&lt;T&gt; {
    type Output = Vector3d&lt;T&gt;;
    fn mul(self, other: Self) -&gt; Self::Output {
        Vector3d::new(self.x * other.x, self.y * other.y, self.z * other.z)
    }
}
impl &lt;T:Num&gt; Div for Vector3d&lt;T&gt; {
    type Output = Vector3d&lt;T&gt;;
    fn div(self, other: Self) -&gt; Self::Output {
        Vector3d::new(self.x / other.x, self.y / other.y, self.z / other.z)
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>One difference with this case is that we need to add an additional trait bound, the <code>Copy</code> trait -- this is because the multiplication and division operators move the value we are multiplying/dividing by. This means that when we do <code>x * y</code>, the arguments are pushed on to the stack, and can no-longer be used in the current scope. Adding the <code>Copy</code> trait ensures that these values can be copied.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// x and y are pushed on to the stack as part of the multiplication operation.
// If they don't implement Copy, they cannot be re-used in this scope.
let a = x * y;
// If x and y implement Copy, Rust will copy them here. 
// Otherwise, the code will fail to compile.
let b = x * z;
<span class="boring">}
</span></code></pre></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="geometry_and_transformations.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="geometry_points.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="geometry_and_transformations.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="geometry_points.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
